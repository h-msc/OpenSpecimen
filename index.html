<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OpenSpecimen</title>
<script src="https://cdn.jsdelivr.net/npm/opentype.js@latest/dist/opentype.min.js"></script>
<style>
:root {
    --bg: #fdfdfc;
    --text: #111;
    --accent: #0066ff;
    --border: #e0e0e0;
    --sidebar-bg: #f8f8f8;
    --glass-bg: rgba(255, 255, 255, 0.75);
    --glass-border: rgba(255, 255, 255, 0.5);
}

body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: var(--bg);
    color: var(--text);
    -webkit-font-smoothing: antialiased;
    overflow-x: hidden;
}

section { padding: 60px 5%; border-bottom: 1px solid var(--border); position: relative; }
h3 { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.1em; color: #888; margin-bottom: 30px; }

/* --- Hero --- */
.hero h1 {
    font-size: clamp(3rem, 15vw, 10rem);
    margin: 0;
    line-height: 0.85;
    letter-spacing: -0.03em;
}

.metadata-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 20px;
    margin-top: 40px;
    border-top: 1px solid var(--border);
    padding-top: 30px;
}

.meta-item label { display: block; font-size: 0.6rem; text-transform: uppercase; font-weight: 800; color: #aaa; margin-bottom: 4px; }
.meta-item span { font-size: 0.85rem; font-weight: 500; }

/* --- Tester --- */
.tester-container { display: flex; gap: 40px; margin-top: 20px; flex-direction: row; }
#typeTester {
    flex: 1; min-height: 300px; border: none; padding: 0;
    font-size: 48px; outline: none; background: transparent;
    line-height: 1.1; resize: vertical; width: 100%;
}

.sidebar {
    width: 300px;
    max-width: 100%;
    padding: 25px;
    background: var(--sidebar-bg);
    border-radius: 16px; 
    position: sticky;
    top: 20px;
    align-self: flex-start;
    z-index: 10;
    box-sizing: border-box;
}

.control-group { margin-bottom: 25px; }
.control-group label { display: block; font-size: 0.65rem; font-weight: 800; text-transform: uppercase; margin-bottom: 10px; color: #777; }
.val { float: right; color: #000; font-family: monospace; font-weight: bold; }

input[type="range"] {
    -webkit-appearance: none;
    appearance: none; 
    width: 100%;
    background: transparent;
    height: 30px;
}
input[type="range"]::-webkit-slider-runnable-track { width: 100%; height: 2px; background: #ddd; }
input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    height: 20px; width: 20px; border-radius: 50%;
    background: #000; cursor: pointer; margin-top: -9px; border: 2px solid var(--sidebar-bg);
}

.reset-btn {
    width: 100%; padding: 12px; background: #eee; border: none; border-radius: 8px;
    font-size: 0.7rem; font-weight: 700; text-transform: uppercase; cursor: pointer; margin-top: 10px;
}

/* --- Glyphs --- */
.glyph-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    border-top: 1px solid var(--border);
    border-left: 1px solid var(--border);
    background: white;
    overflow: visible;
}

.glyph-item {
    aspect-ratio: 1/1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    border-right: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    background: white;
    transition: transform 0.4s cubic-bezier(0.2, 1, 0.2, 1), background 0.3s ease, box-shadow 0.3s ease;
    position: relative;
    z-index: 1;
    will-change: transform;
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    transform-origin: center center;
}

@media (hover: hover) {
    .glyph-item:hover:not(.active) {
        z-index: 5;
        transform: scale(1.2) translateZ(0);
        background: #fff;
        box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    }
}

.glyph-item.active {
    z-index: 100;
    transform: scale(2.5) translateZ(0);
    background: var(--glass-bg);
    backdrop-filter: blur(15px) saturate(180%);
    -webkit-backdrop-filter: blur(15px) saturate(180%);
    border: 1px solid var(--glass-border);
    box-shadow: 0 30px 60px rgba(0,0,0,0.12);
    border-radius: 12px;
}

.char { font-size: 1.8rem; line-height: 1; pointer-events: none; }
.unicode { font-family: monospace; font-size: 0.5rem; color: #aaa; margin-top: 8px; pointer-events: none; }

/* --- Footer --- */
footer { 
    padding: 60px 5%; 
    color: #888; 
    font-size: 0.75rem; 
    border-top: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
}

footer a { color: var(--text); text-decoration: none; font-weight: 600; }

@media (max-width: 850px) {
    .tester-container { flex-direction: column; }
    .sidebar { width: 100%; position: static; }
    .hero h1 { font-size: 4rem; }
    .glyph-item.active { transform: scale(1.8) translateZ(0); }
}
</style>
</head>
<body>

<section class="hero">
    <h1 id="hero-title">Loading...</h1>
    <div class="metadata-grid" id="metaGrid">
        <div class="meta-item"><label>Designer</label><span id="metaDesigner">—</span></div>
        <div class="meta-item"><label>Version</label><span id="metaVersion">—</span></div>
        <div class="meta-item"><label>License</label><span id="metaLicense">—</span></div>
    </div>
</section>

<section id="tester">
    <h3>Interactive Tester</h3>
    <div class="tester-container">
        <textarea id="typeTester" spellcheck="false">The quick brown fox jumps over the lazy dog.</textarea>
        <div class="sidebar" id="axisControls">
            <div class="control-group">
                <label>Size <span class="val" id="sizeVal">48px</span></label>
                <input type="range" id="sizeSlider" min="12" max="150" value="48">
            </div>
            <button class="reset-btn" id="resetAxes">Reset to Default</button>
        </div>
    </div>
</section>

<section id="glyphs">
    <h3>Glyphs</h3>
    <div class="glyph-grid" id="glyphGrid"></div>
</section>

<footer id="main-footer">
    <div class="footer-left">
        <span><strong>OpenSpecimen</strong> v1.0.2</span>
        <span>Created by <a href="https://github.com/h-msc" target="_blank">Hugo Carvalho</a></span>
    </div>
    <div class="footer-right">
        <a href="https://github.com/h-msc/OpenSpecimen" target="_blank">View on GitHub</a>
    </div>
</footer>

<script>
// --- CHANGE THIS!!!! ---
const FONT_FILENAME = 'Roboto-VariableFont_wdth,wght.ttf';
const FONT_PATH = 'fonts/' + FONT_FILENAME;
const CUSTOM_FAMILY = 'SpecimenFont';

opentype.load(FONT_PATH, function(err, font) {
    if (err) {
        document.getElementById('hero-title').innerText = "Font Load Error";
        return;
    }
    setupSpecimen(font);
});

function setupSpecimen(font) {
    const styleSheet = document.createElement('style');
    styleSheet.innerHTML = `@font-face { font-family: '${CUSTOM_FAMILY}'; src: url('${FONT_PATH}'); font-weight: 1 1000; }`;
    document.head.appendChild(styleSheet);

    const heroTitle = document.getElementById('hero-title');
    const metaGrid = document.getElementById('metaGrid');
    const footer = document.getElementById('main-footer');
    const tester = document.getElementById('typeTester');
    const grid = document.getElementById('glyphGrid');
    const axisControls = document.getElementById('axisControls');
    const resetBtn = document.getElementById('resetAxes');

    // Apply the Font Family to all sections
    const elementsToFont = [heroTitle, metaGrid, footer, tester];
    elementsToFont.forEach(el => el.style.fontFamily = CUSTOM_FAMILY);

    // Populate Names
    const names = font.names;
    heroTitle.innerText = names.typographicFamily?.en || names.fontFamily.en;
    document.getElementById('metaDesigner').innerText = names.designer?.en || "Unknown Designer";
    document.getElementById('metaVersion').innerText = names.version?.en || "Version 1.000";
    document.getElementById('metaLicense').innerText = names.license?.en || "Standard License";

    // Generate Glyphs
    grid.innerHTML = '';
    let unicodes = [];
    if (font.tables.cmap && font.tables.cmap.glyphIndexMap) {
        unicodes = Object.keys(font.tables.cmap.glyphIndexMap).map(k => parseInt(k));
    }

    const displayLimit = Math.min(unicodes.length, 400);
    for (let i = 0; i < displayLimit; i++) {
        const code = unicodes[i];
        const div = document.createElement('div');
        div.className = 'glyph-item';
        div.style.fontFamily = CUSTOM_FAMILY;
        
        const hex = "U+" + code.toString(16).toUpperCase().padStart(4, '0');
        div.innerHTML = `<span class="char">${String.fromCodePoint(code)}</span><span class="unicode">${hex}</span>`;
        
        div.addEventListener('click', function(e) {
            const wasActive = this.classList.contains('active');
            const rect = this.getBoundingClientRect();
            const winWidth = window.innerWidth;
            const threshold = rect.width * 1.5;

            // Mobile Edge detection
            this.style.transformOrigin = 'center center';
            if (rect.left < threshold) this.style.transformOrigin = 'left center';
            else if (rect.right > winWidth - threshold) this.style.transformOrigin = 'right center';

            document.querySelectorAll('.glyph-item').forEach(el => el.classList.remove('active'));
            if (!wasActive) this.classList.add('active');
            e.stopPropagation();
        });
        grid.appendChild(div);
    }

    // Generate Axis Sliders
    const defaultAxes = {};
    if (font.tables.fvar && font.tables.fvar.axes) {
        font.tables.fvar.axes.forEach(axis => {
            defaultAxes[axis.tag] = axis.defaultValue;
            const group = document.createElement('div');
            group.className = 'control-group';
            group.innerHTML = `
                <label>${axis.name.en || axis.tag} <span class="val" id="val-${axis.tag}">${axis.defaultValue}</span></label>
                <input type="range" class="axis-slider" data-tag="${axis.tag}" min="${axis.minValue}" max="${axis.maxValue}" value="${axis.defaultValue}">
            `;
            axisControls.insertBefore(group, resetBtn);
        });
    }

    function applyAllSettings() {
        let settings = [];
        document.querySelectorAll('.axis-slider').forEach(s => {
            const tag = s.getAttribute('data-tag');
            document.getElementById(`val-${tag}`).innerText = s.value;
            settings.push(`"${tag}" ${s.value}`);
        });
        const varString = settings.join(', ');
        
        // --- SELECTIVE UPDATING ---
        // We apply variations ONLY to the tester and glyphs
        tester.style.fontVariationSettings = varString;
        document.querySelectorAll('.char').forEach(c => c.style.fontVariationSettings = varString);
        
        // Note: heroTitle and footer are left out so they don't change
    }

    document.body.addEventListener('input', (e) => {
        if (e.target.classList.contains('axis-slider')) applyAllSettings();
        if (e.target.id === 'sizeSlider') {
            const val = e.target.value;
            tester.style.fontSize = val + 'px';
            document.getElementById('sizeVal').innerText = val + 'px';
        }
    });

    resetBtn.addEventListener('click', () => {
        document.querySelectorAll('.axis-slider').forEach(s => s.value = defaultAxes[s.dataset.tag]);
        document.getElementById('sizeSlider').value = 48;
        tester.style.fontSize = '48px';
        document.getElementById('sizeVal').innerText = '48px';
        applyAllSettings();
    });

    applyAllSettings();
}

// Global UI handling
document.addEventListener('keydown', (e) => {
    const active = document.querySelector('.glyph-item.active');
    if (!active) return;
    if (e.key === 'ArrowRight' && active.nextElementSibling) active.nextElementSibling.click();
    if (e.key === 'ArrowLeft' && active.previousElementSibling) active.previousElementSibling.click();
    if (e.key === 'Escape') active.classList.remove('active');
});

document.addEventListener('click', (e) => {
    if (!e.target.closest('.glyph-item')) {
        document.querySelectorAll('.glyph-item').forEach(el => el.classList.remove('active'));
    }
});
</script>
</body>
</html>
